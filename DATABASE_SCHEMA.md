# Database Structure

## Entity Relationship Diagram

```mermaid
erDiagram
    USERS ||--o{ QUIZZES : "creates"
    USERS ||--o{ ATTEMPTS : "makes"
    USERS ||--o{ DOCUMENTS : "uploads"
    USERS {
        string id PK "Clerk User ID"
        string openrouter_api_key
    }

    QUIZZES ||--o{ QUESTIONS : "contains"
    QUIZZES ||--o{ ATTEMPTS : "has"
    QUIZZES {
        int id PK
        string topic
        string quiz_format
        int num_questions
        datetime created_at
        string user_id FK
    }

    QUESTIONS {
        int id PK
        int quiz_id FK
        string text
        json options
        string correct_answer
    }

    ATTEMPTS {
        int id PK
        int quiz_id FK
        string user_id FK
        string score
        json feedback
        datetime timestamp
    }

    DOCUMENTS {
        int id PK
        string user_id FK
        string filename
        string content
        datetime created_at
    }

    SCHOOLS ||--o{ CLASSROOMS : "manages"
    SCHOOLS ||--o{ STUDENTS : "enrolls"
    SCHOOLS ||--o{ SCHOOL_QUIZZES : "creates"
    SCHOOLS {
        int id PK
        string name
        string email
        string password_hash
        string country
        json education_system
        datetime created_at
    }

    CLASSROOMS ||--o{ STUDENTS : "contains"
    CLASSROOMS ||--o{ SCHOOL_QUIZZES : "assigned_to"
    CLASSROOMS {
        int id PK
        int school_id FK
        string name
        string grade_level
        datetime created_at
    }

    STUDENTS ||--o{ STUDENT_ATTEMPTS : "takes"
    STUDENTS {
        int id PK
        int school_id FK
        int classroom_id FK
        string name
        string email
        string student_id "Unique Identifier"
        string password_hash
        string password "Plain Text"
        string openrouter_api_key
        datetime created_at
    }

    SCHOOL_QUIZZES ||--o{ STUDENT_ATTEMPTS : "records"
    SCHOOL_QUIZZES }|..|{ DOCUMENTS : "references (optional)"
    SCHOOL_QUIZZES {
        int id PK
        int school_id FK
        int classroom_id FK
        string topic
        int document_id FK "Optional"
        string additional_notes
        string ai_model
        string quiz_format
        int num_questions
        string difficulty
        json questions
        string created_by
        datetime created_at
    }

    STUDENT_ATTEMPTS {
        int id PK
        int student_id FK
        int school_quiz_id FK
        string score
        json answers
        json questions
        json feedback
        datetime completed_at
    }
```

## Tables Overview

### User Context
- **Users**: Represents the admin/teacher users (authenticated via Clerk).
- **Quizzes**: Quizzes generated by users.
- **Questions**: Individual questions belonging to a quiz.
- **Attempts**: Records of users taking their own quizzes (or potentially testing them).
- **Documents**: Documents uploaded by users for quiz generation.

### School Context
- **Schools**: Represents the school entity.
- **Classrooms**: Classes within a school.
- **Students**: Students enrolled in a specific classroom.
- **SchoolQuizzes**: Quizzes created by the school/teacher for specific classrooms.
- **StudentAttempts**: Records of students taking the assigned school quizzes.

Note: There seems to be a separation between the "User" context (possibly for a SaaS/individual version) and the "School" context (for the school management system). `SchoolQuizzes` can optionally reference `Documents` which are owned by `Users`.
